---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import FAQ from '../../components/FAQ.astro';
import { BLOG_POSTS, AUTHORS } from '../../constants';

const posts = BLOG_POSTS
  .filter(post => {
    const [d, m, y] = post.date.split('-').map(Number);
    const postDate = new Date(y, m - 1, d);
    const now = new Date('2026-02-16');
    return postDate <= now;
  })
  .sort((a, b) => {
    const [da, ma, ya] = a.date.split('-').map(Number);
    const [db, mb, yb] = b.date.split('-').map(Number);
    return new Date(yb, mb - 1, db).getTime() - new Date(ya, ma - 1, da).getTime();
  });

const formatTag = (tag) => {
    return tag.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
};

const getAuthorSlug = (authorName) => {
    return AUTHORS.find(a => a.name === authorName)?.slug || 'maestro';
};
---

<BaseLayout title="Blog | Chikara Nutrition" description="Pergaminos antiguos de sabiduría sobre nutrición, entrenamiento y mentalidad guerrera.">
    <Navbar currentPath="/blog/" />
    
    <main class="pt-32 pb-0 bg-chikara-paper min-h-screen">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Header -->
        <div class="text-center mb-16 relative">
             <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[8rem] md:text-[12rem] text-gray-200 font-jp font-black leading-none pointer-events-none z-0 opacity-50">
                知恵
            </div>
            <h1 class="relative z-10 text-5xl md:text-7xl font-display font-bold text-chikara-ink uppercase tracking-tight">
                Pergaminos <span class="text-chikara-red">Antiguos</span>
            </h1>
            <p class="relative z-10 text-gray-500 mt-4 max-w-2xl mx-auto font-serif italic">
                Conocimiento para nutrir la mente y fortalecer el espíritu.
            </p>
        </div>

        <!-- Blog Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            {posts.map((post) => (
                <article class="group bg-white border border-gray-200 shadow-sm hover:shadow-xl transition-all duration-300 flex flex-col h-full">
                    <div class="relative h-64 overflow-hidden">
                        <div class="absolute inset-0 bg-chikara-ink/20 group-hover:bg-transparent transition-colors z-10"></div>
                        <img 
                            src={post.image} 
                            alt={post.title} 
                            class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700 filter grayscale group-hover:grayscale-0"
                        />
                        <div class="absolute top-4 left-4 z-20">
                            {post.tags[0] && (
                                <span class="bg-chikara-red text-white text-[10px] uppercase font-bold px-3 py-1 tracking-widest shadow-lg">
                                    {formatTag(post.tags[0])}
                                </span>
                            )}
                        </div>
                    </div>

                    <div class="p-8 flex-1 flex flex-col">
                        <div class="flex items-center gap-4 text-xs text-gray-400 mb-4 font-mono uppercase tracking-wide">
                            <span>{post.date}</span>
                            <span class="w-1 h-1 bg-chikara-red rounded-full"></span>
                            <span class="flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                {post.readTime}
                            </span>
                        </div>

                        <h2 class="text-2xl md:text-3xl font-display font-bold text-chikara-ink mb-4 leading-none group-hover:text-chikara-red transition-colors">
                            <a href={`/blog/${post.slug}/`}>{post.title}</a>
                        </h2>

                        <p class="text-gray-500 mb-6 font-light leading-relaxed flex-1 line-clamp-3">
                            {post.excerpt}
                        </p>

                        <div class="flex items-center justify-between mt-auto pt-6 border-t border-gray-100">
                             <a 
                                href={`/autor/${getAuthorSlug(post.author)}/`}
                                class="flex items-center gap-3 cursor-pointer hover:bg-stone-50 p-2 -ml-2 rounded-sm transition-colors"
                             >
                                <img src={post.authorImage} alt={post.author} class="w-8 h-8 rounded-full object-cover grayscale" />
                                <span class="text-xs font-bold uppercase tracking-wider text-chikara-stone group-hover:text-chikara-red transition-colors">{post.author}</span>
                             </a>
                             <a 
                                href={`/blog/${post.slug}/`}
                                class="text-chikara-red font-bold uppercase text-xs tracking-widest flex items-center gap-2 group/btn"
                             >
                                Leer <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right group-hover/btn:translate-x-1 transition-transform"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                             </a>
                        </div>
                    </div>
                </article>
            ))}
        </div>
      </div>

      <!-- Authors Section -->
      <section class="mt-32 py-24 bg-white border-y border-gray-100">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div class="text-center mb-16">
                  <span class="text-chikara-red font-bold uppercase tracking-[0.3em] text-xs">El Clan</span>
                  <h2 class="text-4xl font-display font-bold text-chikara-ink uppercase mt-2">Nuestros <span class="text-chikara-red">Senseis</span></h2>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                  {AUTHORS.map(author => (
                      <div class="bg-white border border-gray-100 shadow-md overflow-hidden group hover:shadow-2xl transition-all duration-500">
                          <div class="flex flex-col sm:flex-row h-full">
                              <div class="sm:w-2/5 relative h-64 sm:h-auto overflow-hidden">
                                  <img src={author.authorImage} alt={author.name} class="w-full h-full object-cover grayscale transition-all duration-700 group-hover:scale-110 group-hover:grayscale-0" />
                              </div>
                              <div class="sm:w-3/5 p-8 flex flex-col justify-center">
                                  <h3 class="text-2xl font-display font-bold text-chikara-ink uppercase mb-2">{author.name}</h3>
                                  <p class="text-chikara-red font-bold uppercase tracking-widest text-[10px] mb-4">{author.role}</p>
                                  <p class="text-gray-500 text-sm italic mb-6 line-clamp-3">"{author.bio}"</p>
                                  <a href={`/autor/${author.slug}/`} class="text-chikara-ink font-bold uppercase text-[10px] tracking-widest hover:text-chikara-red transition-all inline-flex items-center gap-2">
                                      Ver Perfil Completo <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                                  </a>
                              </div>
                          </div>
                      </div>
                  ))}
              </div>
          </div>
      </section>

      <!-- FAQ Section -->
      <FAQ />

    </main>

    <Footer />
</BaseLayout>
